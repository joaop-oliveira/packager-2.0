{"version":3,"sources":["webpack:///./src/lib/index.js"],"names":["data","Package","create","pack","Error","insertPackageData","find","sort","created_at","select","lastVersion","checkVersion","shell","require","zlib","fs","moment","gzip","createGzip","currentDate","format","MEMOIZE","currentVersion","createPackage","inputPath","req","res","body","location","packageDir","version","cd","exec","code","status","send","message","__dirname","e","console","log","buildGzip","inputFile","bigFile","createReadStream","mkdir","gzipedFile","createWriteStream","pipe"],"mappings":";;;;;;;;;;;;;;;;;;;;;mLAeA,iBAAiCA,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACuB,sEAAAC,CAAQC,MAAR,CAAeF,IAAf,CADvB;;AAAA;AACUG,4BADV;;AAAA,4BAESA,IAFT;AAAA;AAAA;AAAA;;AAAA,8BAEqB,IAAIC,KAAJ,CAAUD,IAAV,CAFrB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeE,iB;;;;;;oLAwBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAC4B,sEAAAJ,CAAQK,IAAR,CAAa,EAAb,EACvBC,IADuB,CAClB,EAAEC,YAAY,MAAd,EADkB,EAEvBC,MAFuB,CAEhB,SAFgB,CAD5B;;AAAA;AACQC,mCADR;;AAAA,4BAIOA,WAJP;AAAA;AAAA;AAAA;;AAAA,8BAI0B,IAAIN,KAAJ,CAAUM,WAAV,CAJ1B;;AAAA;AAAA,0DAKSA,WALT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeC,Y;;;;;AAvCf;AACA;AACA,IAAMC,QAAQ,mBAAAC,CAAQ,SAAR,CAAd;AACA,IAAMC,OAAO,mBAAAD,CAAQ,MAAR,CAAb;AACA,IAAME,KAAK,mBAAAF,CAAQ,IAAR,CAAX;AACA,IAAMG,SAAS,mBAAAH,CAAQ,QAAR,CAAf;;AAEA;AACA,IAAMI,OAAOH,KAAKI,UAAL,EAAb;AACA,IAAMC,cAAcH,SAASI,MAAT,CAAgB,YAAhB,CAApB;;AAEA,IAAMC,UAAU;AACdC,oBAAgB;AADF,CAAhB;;AASO,IAAMC,gBAAgB,SAAhBA,aAAgB,CAACC,SAAD,EAAYC,GAAZ,EAAiBC,GAAjB,EAAyB;AACpDD,QAAIE,IAAJ,CAASC,QAAT,kBAAiCT,WAAjC;AACA,QAAMU,4BAA0BV,WAA1B,iBAAiDM,IAAIE,IAAJ,CAASG,OAA1D,SAAN;AACA,QAAG;AACCzB,0BAAkBoB,IAAIE,IAAtB;AACAf,cAAMmB,EAAN,CAAS,8DAAT;AACA,YAAInB,MAAMoB,IAAN,+BAAuCb,WAAvC,iBAA8DM,IAAIE,IAAJ,CAASG,OAAvE,gBAAyFN,SAAzF,EAAsGS,IAAtG,KAA+G,CAAnH,EAAsH;AAClHP,gBAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACjBC,mEAAiDC,SAAjD,GAA6DR,UAD5C,EAArB;AAEH,SAHD,MAGM;AACFH,gBAAIS,IAAJ,CAAS;AACLC,yBAAS;AADJ,aAAT;AAGH;AACJ,KAXD,CAWE,OAAME,CAAN,EAAS;AACPC,gBAAQC,GAAR,CAAYF,CAAZ;AACH;AACF,CAjBM;;AA2BA,IAAMG;AAAA,oLAAY,kBAAOC,SAAP,EAAkBjB,GAAlB,EAAuBC,GAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AACvB;AACA;AACA;AACMiB,+BAJiB,GAIP5B,GAAG6B,gBAAH,CAAoBP,YAAYK,SAAhC,CAJO;;AAKvB9B,8BAAMiC,KAAN,CAAY,IAAZ,kBAAgC1B,WAAhC;AACM2B,kCANiB,GAMJ/B,GAAGgC,iBAAH,iBAAmC5B,WAAnC,iBAA0DM,IAAIE,IAAJ,CAASG,OAAnE,SANI;;AAOvBa,gCAAQK,IAAR,CAAa/B,IAAb,EAAmB+B,IAAnB,CAAwBF,UAAxB;AACApB,4BAAIS,IAAJ,CAAS,EAAEC,SAAS,cAAX,EAAT;;AARuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAZ;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAWP;AACA;AACA;AACA;AACA;AACA,I","file":"0.ae63d31468b52a4138cd.hot-update.js","sourcesContent":["//import statements\nimport Package from '../models/package.model';\nconst shell = require('shelljs');\nconst zlib = require('zlib');\nconst fs = require('fs');\nconst moment = require('moment');\n\n//declare statements\nconst gzip = zlib.createGzip();\nconst currentDate = moment().format('DD-MM-YYYY');\n\nconst MEMOIZE = {\n  currentVersion: null\n};\n\nasync function insertPackageData(data) {\n    const pack = await Package.create(data);\n    if (!pack) throw new Error(pack);\n}\n\nexport const createPackage = (inputPath, req, res) => {\n  req.body.location = `./package/${currentDate}/package-2.0.0`;\n  const packageDir = `/packages/${currentDate}/package-${req.body.version}.zip`;\n  try{\n      insertPackageData(req.body);\n      shell.cd('/home/joaop-oliveira/Documents/node_js/packager-2.0/src/lib/');\n      if (shell.exec(`zip -r -9 ../../packages/${currentDate}/package-${req.body.version}.zip  ./${inputPath}`).code === 0) {\n          res.status(200).send({\n              message: `Pacakage created successfully within ${__dirname}${packageDir}` });\n      } else{\n          res.send({\n              message: \"could not compress the directory\"\n          });\n      }\n  } catch(e) {\n      console.log(e);\n  }\n};\n\nasync function checkVersion() {\n  const lastVersion = await Package.find({})\n    .sort({ created_at: 'desc' })\n    .select('version');\n  if (!lastVersion) throw new Error(lastVersion);\n  return lastVersion;\n}\n\nexport const buildGzip = async (inputFile, req, res) => {\n  // if (MEMOIZE.currentVersion === null) {\n  //   // const nextVersion = checkVersion();\n  // }\n  const bigFile = fs.createReadStream(__dirname + inputFile);\n  shell.mkdir('-p', `./packages/${currentDate}`);\n  const gzipedFile = fs.createWriteStream(`./packages/${currentDate}/package-${req.body.version}.gz`);\n  bigFile.pipe(gzip).pipe(gzipedFile);\n  res.send({ message: 'file created' });\n};\n\n// function createFile(fileName) {\n//   fs.appendFile(fileName, content, function(err) {\n//     if (err) throw new Error(err);\n//     console.log('file saved!!');\n//   });\n// }\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/index.js"],"sourceRoot":""}