{"version":3,"sources":["webpack:///./src/api/packager/index.js","webpack:///./src/lib/index.js"],"names":["express","require","packagerRouter","Router","post","req","res","createPackage","err","console","log","data","Package","create","pack","Error","insertPackageData","find","sort","created_at","select","lastVersion","checkVersion","shell","zlib","fs","moment","fstream","tar","gzip","createGzip","currentDate","format","MEMOIZE","currentVersion","inputPath","body","location","packageDir","version","cd","exec","__dirname","code","status","send","message","e","buildGzip","inputFile","bigFile","createReadStream","mkdir","gzipedFile","createWriteStream","pipe"],"mappings":"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","file":"0.5e14980c02ece853962f.hot-update.js","sourcesContent":["import { createPackage } from '../../lib';\nconst express = require('express');\nexport const packagerRouter = express.Router();\n\n// packagerRouter.use(\"/\", function(req, res) {\n//   res.send({ ok: true });\n// });\n\npackagerRouter.post('/create', (req, res) => {\n\t// console.log('UPPER BODY =====>   ', req.body);\n\ttry {\n\t\tcreatePackage('pack-sample', req, res);\n\t} catch (err) {\n\t\tconsole.log(err);\n\t}\n});\n\n// export default packagerRouter;\n\n\n\n// WEBPACK FOOTER //\n// ./src/api/packager/index.js","//import statements\nimport Package from '../models/package.model';\nconst shell = require('shelljs');\nconst zlib = require('zlib');\nconst fs = require('fs');\nconst moment = require('moment');\nconst fstream = require('fstream');\nconst tar = require('tar');\n//declare statements\nconst gzip = zlib.createGzip();\nconst currentDate = moment().format('DD-MM-YYYY');\n\nconst MEMOIZE = {\n  currentVersion: null\n};\n\nasync function insertPackageData(data) {\n    const pack = await Package.create(data);\n    if (!pack) throw new Error(pack);\n}\n\nexport const createPackage = (inputPath, req, res) => {\n  req.body.location = `./package/${currentDate}/package-2.0.0`;\n  // const zipDir = `zip -r -9 $(pwd)/packages/${currentDate}/package-${req.body.version}.zip . -i  $(pwd)${inputPath}`;\n  const packageDir = `/packages/${currentDate}/package-${req.body.version}.zip`;\n  try{\n      insertPackageData(req.body);\n      shell.cd('/home/joaop-oliveira/Documents/node_js/packager-2.0/src/lib/');\n      if (shell.exec(`zip -r -9 ./${__dirname}/packages/${currentDate}/package-${req.body.version}.zip  ./${inputPath}`).code === 0) {\n          res.status(200).send({\n              message: `Pacakage created successfully within ${__dirname}${packageDir}` });\n      } else{\n          res.send({\n              message: \"could not compress the directory\"\n          });\n      }\n  } catch(e) {\n      console.log(e);\n  }\n};\n\nasync function checkVersion() {\n  const lastVersion = await Package.find({})\n    .sort({ created_at: 'desc' })\n    .select('version');\n  if (!lastVersion) throw new Error(lastVersion);\n  return lastVersion;\n}\n\nexport const buildGzip = async (inputFile, req, res) => {\n  // if (MEMOIZE.currentVersion === null) {\n  //   // const nextVersion = checkVersion();\n  // }\n  const bigFile = fs.createReadStream(__dirname + inputFile);\n  shell.mkdir('-p', `./packages/${currentDate}`);\n  const gzipedFile = fs.createWriteStream(`./packages/${currentDate}/package-${req.body.version}.gz`);\n  bigFile.pipe(gzip).pipe(gzipedFile);\n  res.send({ message: 'file created' });\n};\n\n// function createFile(fileName) {\n//   fs.appendFile(fileName, content, function(err) {\n//     if (err) throw new Error(err);\n//     console.log('file saved!!');\n//   });\n// }\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/index.js"],"sourceRoot":""}